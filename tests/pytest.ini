# Global pytest configuration for this monorepo.
# Note: this file lives in tests/, so paths are relative to this directory.
# If you run `pytest` from the repo root, pytest may not auto-discover this file.
# Running from ./tests will pick it up and collect all suites below.

[pytest]
minversion = 7.0

# Default: run a "fast" pass (skip heavy suites unless explicitly selected).
addopts =
    -ra
    --strict-config
    --strict-markers
    -m "not e2e and not bench and not slow and not fuzz"

# Collect tests from local folder and sibling Python packages.
testpaths =
    .
    ../sdk/python/tests
    ../studio-services/tests

# Marker registry (keeps pytest -q clean and avoids warnings).
markers =
    slow: Long-running tests (network, large fixtures, big compiles). Skipped by default.
    fuzz: Randomized/fuzz tests. Control iterations via PYTEST_FUZZ_ITERS env var.
    bench: Micro/macro benchmarks. Skipped by default (use -m bench).
    e2e: End-to-end flows that require a devnet and/or running services. Skipped by default.

# Async support (pytest-asyncio >= 0.21 recommended).
asyncio_mode = auto

# Make unexpected xfail failures visible.
xfail_strict = true

# Logging: show live logs on failure; keep CI noise down otherwise.
log_cli = false
log_cli_level = INFO
log_format = %(asctime)s %(levelname)s %(name)s: %(message)s
log_date_format = %H:%M:%S

# De-noise common third-party warnings during test runs.
filterwarnings =
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    ignore::ResourceWarning
    ignore:the imp module is deprecated in favour of importlib:DeprecationWarning

# Optional: junit family for CI parsers (uncomment if needed)
# junit_family = xunit2

# Tips:
# - Fast local run (default):            pytest -q
# - Include slow tests:                  pytest -m "slow"
# - Only e2e flows:                      pytest -m "e2e" -q
# - Run a single test file:              pytest path/to/test_file.py -q
# - Increase fuzz iters:                 PYTEST_FUZZ_ITERS=1000 pytest -m fuzz -q
