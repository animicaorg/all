# ┏━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┓
# ┃ Animica Studio Services — container environment (FastAPI proxy)      ┃
# ┃ Purpose: deploy/verify/faucet/artifacts with strict CORS & limits     ┃
# ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┛
# Notes:
# - This file is sourced by ops/docker/entrypoints/services.sh
# - Values can be overridden by your deployment system (Compose/Helm).
# - Secrets here are examples; replace before deploying to the public internet.

# ───────────────────────────── App / Server ─────────────────────────────
STUDIO_ENV=production
HOST=0.0.0.0
PORT=8700
LOG_LEVEL=info                 # debug|info|warning|error
LOG_FORMAT=json                # json|text
METRICS_ENABLED=true
METRICS_PORT=9105
UVICORN_WORKERS=2              # increase for CPU-heavy verify jobs
UVICORN_TIMEOUT=60

# ───────────────────────────── Core / Chain ─────────────────────────────
CHAIN_ID=1                     # guard against cross-network misuse

# ───────────────────────────── Node Endpoints ───────────────────────────
# Primary node HTTP endpoint (required)
RPC_URL=http://node:8545
# Optional WS (used by long polls or subscriptions if available)
WS_URL=ws://node:8546/ws

# ───────────────────────────── CORS / Security ──────────────────────────
# Comma-separated list of allowed browser origins.
CORS_ALLOW_ORIGINS=https://studio.example.com,https://explorer.example.com
# When true, require a bearer/query API key for privileged routes (e.g., faucet).
AUTH_REQUIRE_API_KEY=false
# Comma-separated allowlist of API keys (use CLI to generate real keys in prod).
API_KEYS=dev-local-key

# ───────────────────────────── Rate Limits ──────────────────────────────
# Compact syntax: <bucket>:<rate>[,<bucket>:<rate>...]
# Buckets understood by the service: default,deploy,verify,faucet,artifacts,simulate
RATE_LIMITS=default:600/min,deploy:60/min,verify:60/min,faucet:12/hour,artifacts:120/min,simulate:60/min

# ───────────────────────────── Storage & DB ─────────────────────────────
# Where immutable artifact blobs are stored when STORAGE_BACKEND=fs
STORAGE_DIR=/data/services/artifacts
# Where the service keeps metadata (verifications, queue, rate counters)
DB_URL=sqlite:////data/services/services.db
# Choose: fs | s3  (fs recommended for devnet; s3 for production)
STORAGE_BACKEND=fs
# S3 backend (if STORAGE_BACKEND=s3) — fill in real values before enabling
S3_ENDPOINT=
S3_REGION=
S3_BUCKET=
S3_ACCESS_KEY_ID=
S3_SECRET_ACCESS_KEY=

# ───────────────────────────── Verify Service ───────────────────────────
# Number of background workers processing verify jobs
VERIFY_WORKERS=2
# Upper bounds to prevent abuse
VERIFY_MAX_CODE_BYTES=262144            # 256 KiB
VERIFY_MAX_MANIFEST_BYTES=131072        # 128 KiB
VERIFY_QUEUE_CAPACITY=2000

# ───────────────────────────── Faucet (optional) ────────────────────────
FAUCET_ENABLED=false
# Hot key used ONLY for testnets; never commit a real key. Example placeholder:
FAUCET_KEY=replace_me_with_devnet_private_key_hex
FAUCET_DRIP_AMOUNT=1000000000000000000   # 1 token (adjust to your units)
FAUCET_MIN_INTERVAL_SECONDS=86400        # per-address min interval (24h)
FAUCET_MAX_PER_DAY=3                     # per-address daily cap

# ───────────────────────────── Artifacts API ────────────────────────────
ARTIFACT_MAX_BYTES=1048576              # 1 MiB
ARTIFACT_PUBLIC_LISTING=false           # if true, allow unauthenticated listing

# ───────────────────────────── Preflight / Simulate ─────────────────────
ALLOW_PREFLIGHT_SIMULATE=true
SIMULATE_MAX_GAS=1000000
SIMULATE_TIMEOUT_MS=6000

# ───────────────────────────── Light Verify (optional) ──────────────────
# If enabled, service will do header/DA light checks on submitted data.
LIGHT_VERIFY_ENABLED=true

# ───────────────────────────── Observability ────────────────────────────
TRACE_LOG_RPC_BODIES=false
TRACE_LOG_SQL_PARAMS=false

# ───────────────────────────── Misc / Ops ───────────────────────────────
# If running behind a proxy that sets X-Forwarded-* headers:
TRUST_PROXY_HEADERS=true
