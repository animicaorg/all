[build-system]
requires = ["hatchling>=1.22"]
build-backend = "hatchling.build"

[project]
name = "{{ project_slug }}"
version = "0.1.0"
description = "Animica AICF provider (FastAPI) â€” generated from the provider-aicf-fastapi template."
readme = "README.md"
requires-python = ">=3.10"
license = { text = "Apache-2.0" }
authors = [{ name = "Animica Labs", email = "dev@animica.org" }]

# Core runtime deps: FastAPI service, async client, logging, metrics, robust JSON/CBOR, retries.
dependencies = [
  "fastapi>=0.111",
  "uvicorn[standard]>=0.27",
  "pydantic>=2.5",
  "httpx>=0.27",
  "python-dotenv>=1.0",
  "msgspec>=0.18",
  "orjson>=3.10",
  "structlog>=24.1",
  "prometheus-client>=0.20",
  "tenacity>=8.2",
  "anyio>=4.4",
  "typing-extensions>=4.9"
]

# Opt-in feature groups. Enable with:
#   pip install .[dev] or .[attestation] or .[gpu-cuda] etc.
[project.optional-dependencies]
dev = [
  "pytest>=8.0",
  "pytest-asyncio>=0.23",
  "pytest-cov>=5.0",
  "ruff>=0.5.0",
  "mypy>=1.7",
  "types-requests>=2.31.0.20240218",
  "pytest-httpx>=0.30",
  "coverage>=7.5"
]

# Evidence parsing & verification hooks (wire into app/compute/attestation.py).
attestation = [
  "cryptography>=42.0",
  "cbor2>=5.6.3",
  "pycose>=1.0.1"
]

# Observability extras (beyond base /metrics).
observability = [
  "prometheus-fastapi-instrumentator>=6.1.0",
  "opentelemetry-sdk>=1.26",
  "opentelemetry-exporter-otlp>=1.26"
]

# GPU backends are platform-specific; keep optional and guarded.
gpu-cuda = [
  "cupy-cuda12x>=12.3 ; platform_system=='Linux'"
]
gpu-rocm = [
  "cupy-rocm-5-7>=12.3 ; platform_system=='Linux'"
]
gpu-opencl = [
  "pyopencl>=2024.1"
]

[project.urls]
Homepage = "https://github.com/animica-labs/animica"
Issues = "https://github.com/animica-labs/animica/issues"

# Convenience entrypoints (implement the functions in app/worker.py and app/main.py).
[project.scripts]
aicf-provider-worker = "app.worker:main"
aicf-provider-api = "app.main:run"

[tool.hatch.build.targets.wheel]
packages = ["app"]

[tool.ruff]
line-length = 100
target-version = "py310"
select = [
  "E", "F", "W",      # pycodestyle/pyflakes
  "I",                # isort
  "UP",               # pyupgrade
  "B",                # flake8-bugbear
  "C90"               # mccabe
]
ignore = [
  "E203",  # whitespace before ':'
  "E266",  # too many leading '#'
  "E501"   # handled by formatter if you add one later
]

[tool.mypy]
python_version = "3.10"
warn_unused_ignores = true
warn_unreachable = true
warn_redundant_casts = true
disallow_untyped_defs = true
disallow_incomplete_defs = true
no_implicit_optional = true
strict_equality = true
plugins = []

[tool.pytest.ini_options]
addopts = "-ra -q"
testpaths = ["tests"]
asyncio_mode = "auto"

# uvicorn can be driven via script `aicf-provider-api`, or run like:
#   uvicorn app.main:app --host 0.0.0.0 --port 8080
