# ==============================================================================
# Animica AICF Provider (FastAPI) — .env.example
# ------------------------------------------------------------------------------
# Copy this file to `.env` and adjust values for your environment.
# Never commit real secrets (API keys, mnemonics, passphrases) to version control.
# ==============================================================================

# --- Server -------------------------------------------------------------------
APP_HOST=0.0.0.0                  # Bind address for the FastAPI server
APP_PORT=8080                     # Public port for the provider API
LOG_LEVEL=INFO                    # DEBUG|INFO|WARNING|ERROR
LOG_JSON=true                     # Emit logs as JSON (true/false)

# --- CORS / Access -------------------------------------------------------------
CORS_ALLOW_ORIGINS=http://localhost:5173,http://localhost:3000
CORS_ALLOW_CREDENTIALS=true
ALLOWED_IPS=                      # Optional: comma-separated allowlist of client IPs

# --- Animica Node / Chain ------------------------------------------------------
RPC_URL=http://localhost:8545     # Animica node JSON-RPC base URL (e.g., http://node:8545)
CHAIN_ID=1337                     # 1=mainnet, 2=testnet, 1337=devnet (default for local)

# AICF endpoints are surfaced via the node RPC; usually same as RPC_URL.
AICF_RPC_URL=${RPC_URL}
AICF_CHAIN_ID=${CHAIN_ID}

# --- Provider Identity / Keys --------------------------------------------------
# Choose ONE source of keys. Keystore takes precedence if both are set.
# These keys identify the provider for staking/registry and signing attestations.
PROVIDER_KEYSTORE_PATH=.keys/provider_keystore.json   # Path to AES-GCM encrypted keystore (optional)
PROVIDER_KEYSTORE_PASSPHRASE=change-me                # Passphrase for keystore (DO NOT COMMIT REAL VALUE)
# Alternatively, use a mnemonic (dev only). Keep quoted if set.
# PROVIDER_MNEMONIC="abandon abandon abandon ..."

# Optional static provider id/address override (normally derived from keys).
# PROVIDER_ID=anim1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqq0xdeadbeef
PROVIDER_NAME=local-dev-provider
PROVIDER_REGION=dev/local
PROVIDER_CONTACT=email:dev@example.com,site:https://example.dev
PROVIDER_CAPABILITIES=AI,QUANTUM  # Comma-separated subset: AI,QUANTUM

# --- Concurrency / Quotas ------------------------------------------------------
MAX_CONCURRENT_AI=2
MAX_CONCURRENT_QUANTUM=1
MAX_AI_UNITS_PER_MINUTE=1000
MAX_QUANTUM_UNITS_PER_MINUTE=100
QUEUE_POLL_INTERVAL_MS=500        # If running a pull loop against AICF

# --- SLA Guardrails (self-enforced; AICF also evaluates) -----------------------
SLA_MAX_LATENCY_MS=60000          # Soft upper bound; self-jail if consistently exceeded
SLA_MIN_QOS=0.95                  # Minimum acceptable QoS metric (0.0–1.0)
SLA_MIN_TRAPS_RATIO=0.66          # Quantum traps pass ratio threshold

# --- Backends (compute adapters) -----------------------------------------------
# AI backend: "stub" for local dev; "openai" or "llama" for real models; "custom" for your own.
AI_BACKEND=stub                   # stub|openai|llama|custom
OPENAI_API_KEY=                   # Required if AI_BACKEND=openai
LLAMA_ENDPOINT=                   # e.g., http://localhost:8081 (if AI_BACKEND=llama)
LLAMA_API_KEY=                    # If your llama endpoint needs auth

# Quantum backend: "sim" for local simulation; "qpu_demo" or "custom" otherwise.
QUANTUM_BACKEND=sim              # sim|qpu_demo|custom
QPU_ENDPOINT=                    # e.g., https://qpu.example.com (if QUANTUM_BACKEND!=sim)
QPU_API_KEY=                     # Optional auth for QPU endpoint

# --- Attestation materials (optional in dev; required in prod) -----------------
SGX_ATTESTATION_PATH=            # Path to SGX/TDX quote (if applicable)
SEV_SNP_ATTESTATION_PATH=        # Path to AMD SEV-SNP report
CCA_ATTESTATION_PATH=            # Path to Arm CCA token (CBOR)
QPU_PROVIDER_CERT_PATH=          # Path to QPU provider identity certificate

# --- Persistence / Artifacts ---------------------------------------------------
DB_URL=sqlite:///./provider.db   # SQLite by default; can use Postgres: postgresql+psycopg://user:pass@host/db
RUN_MIGRATIONS_ON_START=true
DATA_DIR=./data
ARTIFACTS_DIR=./data/artifacts
RESULTS_DIR=./data/results

# --- Security / Auth -----------------------------------------------------------
API_KEY=                          # Optional bearer token to protect provider HTTP routes
CALLBACK_SECRET=change-me         # HMAC secret for verifying incoming webhooks (if used)
RATE_LIMIT_RPS=20                 # Token-bucket rate (requests/sec)
RATE_LIMIT_BURST=60               # Token-bucket burst

# --- External URLs / Webhooks --------------------------------------------------
PUBLIC_BASE_URL=http://localhost:${APP_PORT}
WEBHOOK_CALLBACK_URL=             # Where this provider expects to receive job result confirmations (if used)

# --- Metrics & Tracing ---------------------------------------------------------
PROMETHEUS_ENABLED=true
PROMETHEUS_ADDR=0.0.0.0
PROMETHEUS_PORT=9103
OTLP_ENDPOINT=                    # e.g., http://otel-collector:4317
OTLP_HEADERS=                     # e.g., "authorization=Bearer <token>"

# --- Timeouts / Retries --------------------------------------------------------
JOB_START_TIMEOUT_SEC=10
JOB_HARD_TIMEOUT_SEC=120
BACKEND_CONNECT_TIMEOUT_SEC=5
BACKEND_READ_TIMEOUT_SEC=55
RETRY_BACKOFF_BASE_MS=200
RETRY_BACKOFF_MAX_MS=5000

# --- Feature Flags -------------------------------------------------------------
FEATURE_REGISTER_ON_START=true    # Register/refresh provider metadata with AICF on boot
FEATURE_HEARTBEAT_ON_START=true   # Start periodic heartbeats
FEATURE_ACCEPT_ASSIGNMENTS=true   # If false, provider runs in "drain" mode (no new jobs)
