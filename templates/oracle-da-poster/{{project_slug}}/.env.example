# ------------------------------------------------------------------------------
# Oracle DA Poster — Example environment file
# Copy to .env and adjust values for your deployment.
# ------------------------------------------------------------------------------

# ---- Chain / RPC ----------------------------------------------------------------
# HTTP JSON-RPC endpoint of your Animica node (or public devnet).
RPC_URL="http://127.0.0.1:8545"
# Optional WebSocket endpoint (for newHeads/event subscriptions).
WS_URL="ws://127.0.0.1:8546"

# Network/chain identifier; must match the node you’re talking to.
CHAIN_ID=1337

# ---- Signer / Account -----------------------------------------------------------
# The oracle service needs a signer to submit transactions that update
# the on-chain oracle contract. Choose ONE of the following credential options.

# 1) Mnemonic-based signer (recommended for dev/test):
ORACLE_MNEMONIC="abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon abandon about"

# 2) Keystore JSON file (AES-GCM). If you use this, set ORACLE_MNEMONIC empty.
KEYSTORE_PATH=""            # e.g. "./secrets/oracle_keystore.json"
KEYSTORE_PASSWORD=""        # e.g. "change_me_please"

# ---- Oracle Contract ------------------------------------------------------------
# Target oracle contract address (bech32m anim1… or 0x-hex if using hex addressing).
ORACLE_CONTRACT_ADDR="anim1qqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqqp5z0w2"

# Path or URL to the ABI/manifest so the poster knows which function to call.
# You can point this to your repository path or a packaged artifact.
ORACLE_ABI_PATH="./contracts/examples/oracle/manifest.json"

# Name of the method that updates the oracle with a new DA commitment.
# This should be the function that accepts the commitment (bytes/hex) and (optionally)
# a content digest / metadata. Leave blank to use the default from the manifest.
ORACLE_UPDATE_METHOD="update_commitment"

# ---- Data Availability (DA) Service --------------------------------------------
# Base URL for the DA retrieval service or node-mounted DA endpoints.
# For local devnet, this is often part of the main node (via /da/* mount)
# or a dedicated service (see ops/docker & ops/k8s).
DA_API_URL="http://127.0.0.1:7780"

# Namespace to use when posting blobs. Hex-encoded or decimal.
# Keep consistent per-oracle to simplify client reads.
DA_NAMESPACE_ID="0x000001"

# Maximum blob size the service will attempt to post (bytes).
# Must align with network policy (see spec/params.yaml and da/constants).
DA_MAX_BLOB_BYTES=262144   # 256 KiB

# MIME/Content-Type to record alongside the blob (metadata only).
BLOB_MIME_TYPE="application/json"

# ---- Source Data / Posting Policy -----------------------------------------------
# Define how the oracle poster obtains data to write. You can supply a local file,
# a shell command to run, or leave both empty and implement a Python fetcher in code.

# If set, the service will read & post the content of this file whenever it changes.
SOURCE_FILE_PATH=""                     # e.g. "./data/current_price.json"

# If set, the service will periodically execute this command and post its stdout.
# The command must exit 0 and print the full payload to stdout.
SOURCE_COMMAND=""                       # e.g. "python scripts/fetch_price.py"

# Poll interval (seconds) for SOURCE_* checks. Kept small for dev.
POLL_INTERVAL_SEC=10

# Only post when content changed vs last on-chain value.
POST_IF_CHANGED=true

# Minimal absolute change (basis points = 1/100 of a percent) to trigger a post
# when POST_IF_CHANGED=true. Example: 50 = 0.50% threshold.
MIN_CHANGE_BPS=50

# ---- Networking / Retries -------------------------------------------------------
# Default HTTP timeout when talking to RPC/DA endpoints (seconds).
HTTP_TIMEOUT_SEC=15

# Max attempts on transient failures.
RETRY_MAX=5

# Exponential backoff (milliseconds).
RETRY_BACKOFF_INITIAL_MS=200
RETRY_BACKOFF_MAX_MS=2000

# ---- Observability --------------------------------------------------------------
# Log level: DEBUG, INFO, WARNING, ERROR
LOG_LEVEL="INFO"

# Prometheus metrics listener (set empty to disable).
PROMETHEUS_PORT=9109

# Optional metrics labels (helpful in multi-instance deployments).
METRIC_LABEL_SERVICE="oracle-da-poster"
METRIC_LABEL_INSTANCE="local-dev"

# ---- CORS / Security (only relevant if you expose an HTTP status page) ----------
# Comma-separated list of allowed origins for any optional HTTP status endpoints.
ALLOW_ORIGINS="*"

# ---- Advanced / Expert ----------------------------------------------------------
# Override the tx gas price policy (leave empty to let the node suggest or use defaults).
TX_GAS_PRICE_GWEI=""

# Nonce management: set to "true" to let the poster manage account nonces locally,
# otherwise it will rely on the node's pending pool.
LOCAL_NONCE_MANAGER=false

# If your node enforces PQ algorithm policy, set the signer algorithm here if needed.
# Accepted values depend on network policy (e.g., "dilithium3", "sphincs_shake_128s").
SIGNER_ALG_ID="dilithium3"
