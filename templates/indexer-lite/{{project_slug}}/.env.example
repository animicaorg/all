# ------------------------------------------------------------------------------
# {{ project_slug }} — Indexer Lite (.env example)
# Copy to .env and edit as needed.
#
# This indexer tails the Animica node via HTTP/JSON-RPC and WebSocket, persists
# minimal read models (blocks/tx/receipts/logs) into SQLite/Postgres, and can
# optionally expose a tiny read-only HTTP API and Prometheus /metrics.
# ------------------------------------------------------------------------------

##########
# NODE CONNECTION
##########
# HTTP JSON-RPC endpoint (Animica node mounts JSON-RPC at /rpc by default)
RPC_HTTP_URL=http://localhost:8545/rpc

# WebSocket endpoint (for live newHeads/pendingTxs; node mounts at /ws by default)
RPC_WS_URL=ws://localhost:8545/ws

# Expected chain id (guards against pointing at the wrong network)
CHAIN_ID=1337

# HTTP timeout seconds for RPC calls
RPC_TIMEOUT_SEC=20

##########
# DATABASE (SQLAlchemy URL)
##########
# SQLite (default, single-file, easiest to start)
DB_URL=sqlite:///./indexer.db

# Postgres (uncomment and adjust if using Postgres)
# DB_URL=postgresql+psycopg://animica:animica@localhost:5432/animica_indexer

# Optional pooling (mostly relevant for Postgres)
DB_POOL_SIZE=10
DB_POOL_MAX_OVERFLOW=20
DB_ECHO=false

##########
# INDEXING TOGGLES
##########
INDEX_BLOCKS=true
INDEX_TXS=true
INDEX_RECEIPTS=true
INDEX_LOGS=true

# Optional modules (enable if your schema/code supports them)
INDEX_DA=false            # DA commitments/proofs summaries
INDEX_AICF=false          # AICF job/result summaries
INDEX_RANDOMNESS=false    # randomness beacon rounds

##########
# RANGE & FLOW CONTROL
##########
# Where to begin:
#  - "auto"  : resume from DB checkpoint or genesis if empty
#  - integer : explicit start height (e.g., 0 or 1000)
START_HEIGHT=auto

# Optional hard stop (blank = follow head indefinitely)
END_HEIGHT=

# Blocks per backfill batch
BATCH_SIZE=200

# Parallelism for RPC fetch/parse (tune based on node & DB)
CONCURRENCY=8

# Poll interval (seconds) when using HTTP head polling
HEAD_POLL_INTERVAL_SEC=2

# Subscribe to WS newHeads (preferred when available)
WS_SUBSCRIBE=true

##########
# RESILIENCE / RETRIES
##########
MAX_RETRIES=6
RETRY_BACKOFF_BASE_MS=250
RETRY_BACKOFF_MAX_MS=5000
WS_RECONNECT_BACKOFF_MS=1000

##########
# CHECKPOINTS & MAINTENANCE
##########
# Persist progress every N blocks
CHECKPOINT_EVERY_N_BLOCKS=200

# Run SQLite VACUUM on clean shutdown (costly on very large DBs)
VACUUM_ON_EXIT=false

##########
# OPTIONAL READ-ONLY HTTP API
##########
API_ENABLE=false
API_HOST=0.0.0.0
API_PORT=8080
# Comma-separated origins or "*" for permissive local dev
API_CORS_ALLOW_ORIGINS=*

##########
# METRICS (Prometheus)
##########
METRICS_PORT=9108

##########
# LOGGING
##########
LOG_LEVEL=INFO         # DEBUG | INFO | WARN | ERROR
LOG_FORMAT=json        # json | text

##########
# FILTERS (OPTIONAL — reduce volume for targeted indexing)
##########
# Comma-separated bech32/hex addresses to include (empty = all)
ADDRESS_ALLOWLIST=
# Comma-separated hex topics (0x...) to include for logs (empty = all)
TOPIC1_ALLOWLIST=

##########
# IDENTIFICATION (labels helpful in dashboards)
##########
SERVICE_NAME=indexer-lite
SERVICE_ENV=dev
