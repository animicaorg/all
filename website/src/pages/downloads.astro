---
import BaseLayout from "../layouts/BaseLayout.astro";
import InlineLink from "../components/InlineLink.astro";
import CodeBlock from "../components/CodeBlock.astro";

const pageTitle = "Downloads — Wallet & Explorer";
const pageDesc =
  "Official desktop downloads for Animica Wallet and Explorer, plus CI build artifacts and signature verification tips.";
---

<BaseLayout title={pageTitle} description={pageDesc}>
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
    <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">Downloads</h1>
    <p class="mt-3 text-base opacity-80">
      Get the latest <strong>Wallet (desktop)</strong> and <strong>Explorer (desktop)</strong> builds.
      Prefer official releases for production. CI artifacts are provided for testing only.
    </p>

    <div class="mt-6 flex gap-3 flex-wrap">
      <a
        href="https://github.com/animica/animica/releases/latest"
        class="inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
               bg-[var(--btn-primary-bg,#111)] text-[var(--btn-primary-fg,#fff)]
               hover:opacity-90 focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2"
        target="_blank" rel="noopener noreferrer"
      >
        Latest Releases (GitHub)
        <svg viewBox="0 0 20 20" class="size-4" fill="currentColor" aria-hidden="true">
          <path d="M11 3a1 1 0 100 2h2.586L8.293 10.293a1 1 0 001.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/>
          <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/>
        </svg>
      </a>
      <a
        href="https://github.com/animica/animica/actions?query=workflow%3Awallet+is%3Asuccess"
        class="inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
               border border-[color-mix(in_srgb,var(--text-primary)_/_20%,transparent)]
               hover:bg-[color-mix(in_srgb,var(--text-primary)_/_6%,transparent)]"
        target="_blank" rel="noopener noreferrer"
      >
        CI Artifacts — Wallet
      </a>
      <a
        href="https://github.com/animica/animica/actions?query=workflow%3Aexplorer-desktop+is%3Asuccess"
        class="inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
               border border-[color-mix(in_srgb,var(--text-primary)_/_20%,transparent)]
               hover:bg-[color-mix(in_srgb,var(--text-primary)_/_6%,transparent)]"
        target="_blank" rel="noopener noreferrer"
      >
        CI Artifacts — Explorer
      </a>
    </div>
  </section>

  <!-- Wallet Downloads -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8">
    <div class="rounded-2xl border p-6 sm:p-8 bg-[var(--bg-elevated)]
                border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
      <h2 class="text-xl font-semibold tracking-tight">Wallet (Desktop)</h2>
      <p class="mt-2 text-sm opacity-80">
        Cross-platform desktop wallet (Flutter). Signed installers are published with each release.
      </p>

      <div class="mt-5 grid gap-6 sm:grid-cols-3">
        <div>
          <h3 class="font-medium">macOS (Universal)</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li>
              <InlineLink href="https://github.com/animica/animica/releases/latest" underline>
                Animica-Wallet.dmg
              </InlineLink>
            </li>
            <li class="opacity-75">Alt: <InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Wallet.pkg</InlineLink></li>
            <li class="opacity-70 text-xs">Requires macOS 12+</li>
          </ul>
        </div>

        <div>
          <h3 class="font-medium">Windows</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li>
              <InlineLink href="https://github.com/animica/animica/releases/latest" underline>
                Animica-Wallet.msix
              </InlineLink>
            </li>
            <li class="opacity-75">Alt (optional): <InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Wallet-Setup.exe (NSIS)</InlineLink></li>
            <li class="opacity-70 text-xs">Requires Windows 10/11</li>
          </ul>
        </div>

        <div>
          <h3 class="font-medium">Linux</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li><InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Wallet.AppImage</InlineLink></li>
            <li><InlineLink href="https://flathub.org/apps/io.animica.Wallet" underline>Flatpak (Flathub)</InlineLink></li>
            <li class="opacity-75">DEB/RPM packages in Releases</li>
          </ul>
        </div>
      </div>

      <div class="mt-6">
        <h4 class="font-medium">macOS update feeds (Sparkle)</h4>
        <ul class="mt-2 space-y-1 text-sm">
          <li>Stable: <InlineLink href="https://updates.example.com/wallet/stable/appcast.xml" underline>appcast.xml</InlineLink></li>
          <li>Beta: <InlineLink href="https://updates.example.com/wallet/beta/appcast.xml" underline>appcast.xml</InlineLink></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Explorer Downloads -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 mt-10">
    <div class="rounded-2xl border p-6 sm:p-8 bg-[var(--bg-elevated)]
                border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
      <h2 class="text-xl font-semibold tracking-tight">Explorer (Desktop)</h2>
      <p class="mt-2 text-sm opacity-80">
        Tauri-based desktop wrapper for the web Explorer (offline mode optional).
      </p>

      <div class="mt-5 grid gap-6 sm:grid-cols-3">
        <div>
          <h3 class="font-medium">macOS (Universal)</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li><InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Explorer.dmg</InlineLink></li>
            <li class="opacity-70 text-xs">Requires macOS 12+</li>
          </ul>
        </div>
        <div>
          <h3 class="font-medium">Windows</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li><InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Explorer.msix</InlineLink></li>
            <li class="opacity-70 text-xs">Requires Windows 10/11</li>
          </ul>
        </div>
        <div>
          <h3 class="font-medium">Linux</h3>
          <ul class="mt-2 space-y-2 text-sm">
            <li><InlineLink href="https://github.com/animica/animica/releases/latest" underline>Animica-Explorer.AppImage</InlineLink></li>
            <li class="opacity-75">DEB/RPM packages in Releases</li>
          </ul>
        </div>
      </div>

      <div class="mt-6">
        <h4 class="font-medium">macOS update feeds (Sparkle)</h4>
        <ul class="mt-2 space-y-1 text-sm">
          <li>Stable: <InlineLink href="https://updates.example.com/explorer/stable/appcast.xml" underline>appcast.xml</InlineLink></li>
          <li>Beta: <InlineLink href="https://updates.example.com/explorer/beta/appcast.xml" underline>appcast.xml</InlineLink></li>
        </ul>
      </div>
    </div>
  </section>

  <!-- Checksums & Signature Verification -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 mt-10">
    <div class="rounded-2xl border p-6 sm:p-8 bg-[var(--bg-elevated)]
                border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
      <h2 class="text-xl font-semibold tracking-tight">Verify your download</h2>
      <p class="mt-2 text-sm opacity-80">
        Always verify checksums and signatures before installing. Release notes include SHA-256 hashes.
      </p>

      <div class="mt-4 grid gap-6 md:grid-cols-2">
        <div>
          <CodeBlock lang="bash" title="macOS: Gatekeeper & notarization">
{`# 1) Verify signature & notarization
spctl --assess -vv --type install "Animica-Wallet.dmg"
# 2) (Optional) Verify staple
xcrun stapler validate "Animica-Wallet.app"
# 3) Verify checksum
shasum -a 256 "Animica-Wallet.dmg"`}
          </CodeBlock>
        </div>
        <div>
          <CodeBlock lang="powershell" title="Windows: Authenticode & timestamp">
{`# Requires Windows SDK (signtool)
signtool verify /pa /all /v .\\Animica-Wallet.msix
# Check publisher matches expected subject (CN=Animica, ...).
# Verify SHA-256 checksum
Get-FileHash .\\Animica-Wallet.msix -Algorithm SHA256`}
          </CodeBlock>
        </div>
        <div>
          <CodeBlock lang="bash" title="Linux: AppImage / DEB / RPM">
{`# AppImage
sha256sum Animica-Wallet.AppImage

# DEB
dpkg-sig --verify animica-wallet_X.Y.Z_amd64.deb || true
sha256sum animica-wallet_X.Y.Z_amd64.deb

# RPM
rpm --checksig animica-wallet-X.Y.Z.x86_64.rpm
sha256sum animica-wallet-X.Y.Z.x86_64.rpm`}
          </CodeBlock>
        </div>
        <div>
          <p class="text-sm opacity-80">
            See also: <InlineLink href="https://github.com/animica/animica/blob/main/installers/scripts/verify_signatures.sh" underline>
              verify_signatures.sh
            </InlineLink>
          </p>
        </div>
      </div>
    </div>
  </section>

  <!-- Notes -->
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 my-14 sm:my-20">
    <h2 class="text-xl font-semibold tracking-tight">Notes</h2>
    <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
      <li>
        CI artifacts are unsigned preview builds intended for development and QA. Use at your own risk.
      </li>
      <li>
        For managed updates on macOS, point the app to the appropriate Sparkle appcast (Stable/Beta).
      </li>
      <li>
        If your OS warns about an untrusted developer, re-download from the official
        <InlineLink href="https://github.com/animica/animica/releases/latest" underline>Releases page</InlineLink>
        and verify signatures.
      </li>
    </ul>
  </section>
</BaseLayout>
