---
import BaseLayout from "../layouts/BaseLayout.astro";
import InlineLink from "../components/InlineLink.astro";
import CTAButtons from "../components/CTAButtons.astro";
import CodeBlock from "../components/CodeBlock.astro";
import EmbedVideo from "../components/EmbedVideo.astro";

import { links } from "../config/links";
import { site } from "../config/site";

const pageTitle = "Studio — Build, simulate, deploy";
const pageDesc =
  "Animica Studio is a web IDE to write Python-VM contracts, simulate calls in-browser (WASM), and deploy on-chain. No server-side signing.";

const studioHome = links.studio.home();
const servicesDocs = links?.services?.docs ?? links.docs.home();
const walletHome = links?.wallet?.home ?? links.explorer.home();
---

<BaseLayout title={pageTitle} description={pageDesc}>
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
    <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">
      Studio
    </h1>
    <p class="mt-3 text-base opacity-80">
      Studio is a browser-based environment to
      <strong>edit</strong>, <strong>simulate</strong>, and <strong>deploy</strong>
      Python-VM contracts. It runs a trimmed VM in WebAssembly for local
      simulation, and talks to your node via JSON-RPC for deploy/verify. Keys stay in your
      wallet — Studio never holds secrets.
    </p>

    <div class="mt-6">
      <a
        href={studioHome}
        class="inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
               bg-[var(--btn-primary-bg,#111)] text-[var(--btn-primary-fg,#fff)]
               hover:opacity-90 focus:outline-none focus-visible:ring-2
               focus-visible:ring-offset-2 focus-visible:ring-[color-mix(in_srgb,var(--text-primary,_#000)_/_30%,transparent)]"
        target="_blank"
        rel="noopener noreferrer"
      >
        Open Studio
        <svg viewBox="0 0 20 20" class="size-4" fill="currentColor" aria-hidden="true">
          <path d="M11 3a1 1 0 100 2h2.586L8.293 10.293a1 1 0 001.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/>
          <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/>
        </svg>
      </a>
      <p class="mt-2 text-sm opacity-70">
        Deep link: <InlineLink href={studioHome} underline>{studioHome}</InlineLink>
      </p>
    </div>

    <div class="mt-10 grid gap-6 sm:grid-cols-2">
      <div class="rounded-xl border p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="font-medium">What you get</h3>
        <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
          <li>Monaco editor with diagnostics and gas estimates</li>
          <li>In-browser simulator (Pyodide/WASM) — no node required</li>
          <li>Deploy &amp; verify via <InlineLink href={servicesDocs} underline noIcon>Studio Services</InlineLink></li>
          <li>Data Availability, AI/Quantum capability hooks (read-only helpers)</li>
        </ul>
      </div>
      <div class="rounded-xl border p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="font-medium">Prerequisites</h3>
        <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
          <li>A modern browser (Chromium, Firefox, Safari recent)</li>
          <li>RPC target reachable: <InlineLink href={links.rpc.url} underline noIcon>{links.rpc.url}</InlineLink></li>
          <li>Optional: <InlineLink href={walletHome} underline>Animica Wallet</InlineLink> for local signing</li>
        </ul>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 mt-4 sm:mt-0">
    <div class="grid gap-8 lg:grid-cols-2">
      <div>
        <h2 class="text-xl font-semibold tracking-tight">Quickstart</h2>
        <ol class="mt-3 space-y-2 text-sm opacity-85 list-decimal pl-5">
          <li>Open Studio and select the <em>Counter</em> example.</li>
          <li>Click <strong>Simulate</strong> → run <code>inc()</code>, then <code>get()</code>.</li>
          <li>Switch to <strong>Deploy</strong>, connect your wallet, pick a network, and publish.</li>
          <li>Follow the link to Explorer to watch the transaction and emitted events.</li>
        </ol>

        <div class="mt-5">
          <CodeBlock lang="ts" title="Call a deployed contract from the TypeScript SDK">
{`import { Client } from '@animica/sdk';

const client = new Client({ rpcUrl: '${links.rpc.url}' });
const counter = client.contracts.bind('${site.brand?.toLowerCase() || "animica"}', {
  address: 'anim1xxxx...counter',
  abi: [ { name: 'get', inputs: [], outputs: ['uint64'] } ]
});

const value = await counter.call('get', []);
console.log('Counter value:', value);
`}
          </CodeBlock>
        </div>
      </div>

      <div>
        <h2 class="text-xl font-semibold tracking-tight">2-minute tour</h2>
        <p class="mt-2 text-sm opacity-80">
          This short walkthrough shows simulation and deploy loops directly in the browser.
        </p>
        <div class="mt-3">
          <EmbedVideo
            url="https://www.youtube.com/watch?v=dQw4w9WgXcQ"
            title="Animica Studio — quick tour"
            privacyEnhanced
            aspect="16:9"
            autoplayOnClick
          />
        </div>
      </div>
    </div>
  </section>

  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 mt-14 sm:mt-20">
    <h2 class="text-xl font-semibold tracking-tight">Troubleshooting</h2>
    <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
      <li>If the simulator fails to load, hard refresh to bust the Pyodide cache.</li>
      <li>For RPC errors, confirm the configured Chain ID matches your target network.</li>
      <li>Verify your wallet has permissions to connect to <code>{new URL(studioHome).host}</code>.</li>
    </ul>
    <div class="mt-6">
      <CTAButtons />
    </div>
  </section>
</BaseLayout>
