---
import BaseLayout from "../layouts/BaseLayout.astro";
import InlineLink from "../components/InlineLink.astro";
import CodeBlock from "../components/CodeBlock.astro";
import EmbedVideo from "../components/EmbedVideo.astro";
import StatusBadge from "../components/StatusBadge.tsx";
import MetricTicker from "../components/MetricTicker.tsx";

import { links } from "../config/links";

const pageTitle = "Explorer — browse blocks, txs, events";
const pageDesc =
  "Animica Explorer is a lightweight web app to browse blocks, transactions, receipts, logs, and network metrics in real time.";
---

<BaseLayout title={pageTitle} description={pageDesc}>
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 py-10 sm:py-14">
    <h1 class="text-3xl sm:text-4xl font-semibold tracking-tight">
      Explorer
    </h1>
    <p class="mt-3 text-base opacity-80">
      The Explorer gives you a live view into the chain: heads, finalized blocks, transaction
      receipts, contract events, and data-availability commitments. It connects directly to your
      configured RPC endpoint and never requires wallet permissions for read-only views.
    </p>

    <div class="mt-6">
      <a
        href={links.explorer.home}
        class="inline-flex items-center gap-2 rounded-lg px-4 py-2 font-medium
               bg-[var(--btn-primary-bg,#111)] text-[var(--btn-primary-fg,#fff)]
               hover:opacity-90 focus:outline-none focus-visible:ring-2
               focus-visible:ring-offset-2 focus-visible:ring-[color-mix(in_srgb,var(--text-primary,_#000)_/_30%,transparent)]"
        target="_blank"
        rel="noopener noreferrer"
      >
        Open Explorer
        <svg viewBox="0 0 20 20" class="size-4" fill="currentColor" aria-hidden="true">
          <path d="M11 3a1 1 0 100 2h2.586L8.293 10.293a1 1 0 001.414 1.414L15 6.414V9a1 1 0 102 0V4a1 1 0 00-1-1h-5z"/>
          <path d="M5 5a2 2 0 00-2 2v8a2 2 0 002 2h8a2 2 0 002-2v-3a1 1 0 10-2 0v3H5V7h3a1 1 0 000-2H5z"/>
        </svg>
      </a>
      <p class="mt-2 text-sm opacity-70">
        Deep link: <InlineLink href={links.explorer.home} underline>{links.explorer.home}</InlineLink>
      </p>
    </div>
  </section>

  <!-- Live status -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 -mt-6 sm:mt-0">
    <div class="grid grid-cols-1 gap-4 sm:grid-cols-3">
      <div class="rounded-xl border p-4 sm:p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium opacity-80">Network Status</h3>
          <StatusBadge client:load rpcUrl={links.rpc.url} />
        </div>
        <p class="mt-3 text-2xl font-semibold tracking-tight">
          <MetricTicker client:load rpcUrl={links.rpc.url} kind="height" />
        </p>
        <p class="text-xs opacity-70 mt-1">Current head height</p>
      </div>

      <div class="rounded-xl border p-4 sm:p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="text-sm font-medium opacity-80">Approx. TPS</h3>
        <p class="mt-3 text-2xl font-semibold tracking-tight">
          <MetricTicker client:load rpcUrl={links.rpc.url} kind="tps" />
        </p>
        <p class="text-xs opacity-70 mt-1">Recent 60s average</p>
      </div>

      <div class="rounded-xl border p-4 sm:p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="text-sm font-medium opacity-80">RPC Endpoint</h3>
        <p class="mt-3 font-mono text-sm break-all">{links.rpc.url}</p>
        <p class="text-xs opacity-70 mt-1">Configured target</p>
      </div>
    </div>
  </section>

  <!-- What you can do -->
  <section class="mx-auto max-w-6xl px-4 sm:px-6 lg:px-8 mt-12 sm:mt-16">
    <div class="grid gap-6 sm:grid-cols-2">
      <div class="rounded-xl border p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="font-medium">Features</h3>
        <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
          <li>Live head, recent blocks &amp; finalized checkpoints</li>
          <li>Transaction details with receipts &amp; event logs</li>
          <li>Contract views (ABI-aware decoding when available)</li>
          <li>Data Availability commitments &amp; proofs (if DA node configured)</li>
          <li>WebSocket subscriptions for new heads &amp; pending txs</li>
        </ul>
      </div>

      <div class="rounded-xl border p-5 bg-[var(--bg-elevated)]
                  border-[color-mix(in_srgb,var(--text-primary)_/_12%,transparent)]">
        <h3 class="font-medium">Quickstart (API)</h3>
        <p class="mt-2 text-sm opacity-85">
          Explorer uses the same JSON-RPC you can call directly:
        </p>
        <div class="mt-3">
          <CodeBlock lang="bash" title="Query head via JSON-RPC">
{`curl -s ${links.rpc.url}/rpc \\
  -H 'content-type: application/json' \\
  -d '{"jsonrpc":"2.0","id":1,"method":"chain.getHead","params":[]}' | jq .`}
          </CodeBlock>
        </div>
        <div class="mt-4">
          <CodeBlock lang="ts" title="Subscribe to newHeads (TypeScript SDK)">
{`import { Client } from '@animica/sdk';

const client = new Client({ rpcUrl: '${links.rpc.url}' });
const sub = await client.ws.subscribe('newHeads', (head) => {
  console.log('New head:', head.height, head.hash);
});`}
          </CodeBlock>
        </div>
      </div>
    </div>
  </section>

  <!-- Video -->
  <section class="mx-auto max-w-5xl px-4 sm:px-6 lg:px-8 mt-12 sm:mt-16">
    <h2 class="text-xl font-semibold tracking-tight">90-second tour</h2>
    <p class="mt-2 text-sm opacity-80">
      A quick demo of following a transaction from submit to inclusion and receipt.
    </p>
    <div class="mt-3">
      <EmbedVideo
        url="https://www.youtube.com/watch?v=oHg5SJYRHA0"
        title="Animica Explorer — quick tour"
        privacyEnhanced
        aspect="16:9"
        autoplayOnClick
      />
    </div>
  </section>

  <!-- Troubleshooting -->
  <section class="mx-auto max-w-3xl px-4 sm:px-6 lg:px-8 mt-14 sm:mt-20 mb-16 sm:mb-28">
    <h2 class="text-xl font-semibold tracking-tight">Troubleshooting</h2>
    <ul class="mt-3 space-y-2 text-sm opacity-85 list-disc pl-5">
      <li>No data loading? Confirm your RPC endpoint (<code>{links.rpc.url}</code>) is reachable from the browser.</li>
      <li>Heights not changing? Check node liveness and your WebSocket URL if using live subscriptions.</li>
      <li>Contract decoding issues? Ensure the ABI was verified and published (via Studio Services).</li>
    </ul>
    <p class="mt-4 text-sm opacity-80">
      Need a different network? Switch the RPC/Chain ID in your <code>.env</code> and rebuild the site, or open Explorer with a network query string if supported.
    </p>
  </section>
</BaseLayout>
